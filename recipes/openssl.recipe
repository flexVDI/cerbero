# -*- Mode: Python -*- vi:si:et:sw=4:sts=4:ts=4:syntax=python


class Recipe(recipe.Recipe):
    name = 'openssl'
    version = '1.0.1p'
    stype = SourceType.TARBALL
    url = 'https://www.openssl.org/source/openssl-1.0.1p.tar.gz'
    autoreconf = False
    autoreconf_sh = 'chmod +w config.sub config.guess'
    configure_tpl = './Configure --prefix=%(prefix)s %(options)s '
    patches = ['openssl/0001-Allow-and-ignore-disable-introspection-.-For-iPhoneO.patch',
               'openssl/0002-Remove-install_docs.patch',
               'openssl/0003-When-building-for-android-on-cerbero-use-CFLAGS.patch']
    add_host_build_target = False
    disable_introspection = True

    files_devel = ['include/openssl',
                   'lib/pkgconfig/openssl.pc',
                   'lib/pkgconfig/libssl.pc',
                   'lib/pkgconfig/libcrypto.pc']

    files_libs = ['libssl','libcrypto']

    def prepare(self):
        if self.config.target_platform == Platform.DARWIN:
            if self.config.target_arch == Architecture.X86_64:
                self.configure_options += ' darwin64-x86_64-cc'
            else:
                self.configure_options += ' darwin-i386-cc'
        elif self.config.target_platform == Platform.IOS:
            self.configure_options += ' iphoneos-cross'
        elif self.config.target_platform == Platform.ANDROID:
            if self.config.target_arch == Architecture.X86:
                self.configure_options += ' android-x86'
            elif self.config.target_arch == Architecture.X86_64:
                self.configure_options += ' android-x86'
            elif self.config.target_arch == Architecture.ARMv7:
                self.configure_options += ' android-armv7'
            else:
                self.configure_options += ' android-arm'

        if self.config.target_arch == Architecture.X86_64:
            self.configure_options += ' no-asm'
